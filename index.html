<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cronograma - Congregación Lago Rapel</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body { padding: 20px; background: #f4f6f9; }
    th { background: #0d47a1; color: white; }
    td { vertical-align: middle; }
    #map { width: 100%; height: 60vh; margin-bottom:20px; }
  </style>
</head>
<body>
  <h2 class="text-center mb-4">Semana del 18 al 24 de Agosto</h2>

  <!-- Mapa interactivo -->
  <div id="map"></div>

  <!-- Cronograma -->
  <div class="table-responsive">
    <table class="table table-bordered text-center">
      <thead>
        <tr>
          <th>FECHA</th>
          <th>HORA</th>
          <th>ENCUENTRO</th>
          <th>DIRECCIÓN</th>
          <th>TERRITORIO</th>
          <th>N°</th>
          <th>ENCARGADO</th>
        </tr>
      </thead>
      <tbody>
        <!-- Aquí va todo tu cronograma tal cual lo tenías -->
        <!-- Lunes 18 -->
        <tr style="background:#bbdefb;">
          <td><b>Lunes 18</b></td>
          <td>10:00 - 12:00</td>
          <td>Pasado la parcelación PORTON AZUL</td>
          <td>Alto el Manzano</td>
          <td><a href="#" onclick="cargarTerritorio('territorios/diesel_los_lagos.kml')">Diesel Los Lagos</a></td>
          <td>36</td>
          <td>Modesto Abarca</td>
        </tr>
        <tr style="background:#90caf9;">
          <td></td>
          <td>19:00 - 21:00</td>
          <td><a href="https://zoom.us/j/6148735306?pwd=mateo2414" target="_blank">Zoom ID: 614 873 5306</a></td>
          <td></td>
          <td>Predicación: "Telefónica y cartas"</td>
          <td></td>
          <td>Guillermo Carvajal</td>
        </tr>
        <!-- ...continúa todo tu cronograma como estaba... -->
      </tbody>
    </table>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-omnivore@0.3.4/leaflet-omnivore.min.js"></script>
  <script>
    // Inicializar mapa
    var map = L.map('map').setView([-34.2, -71.4], 11); // Ajusta al centro de Lago Rapel
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '© OpenStreetMap'
    }).addTo(map);

    var kmlLayer; // capa KML actual

    function cargarTerritorio(kmlFile) {
      if (kmlLayer) map.removeLayer(kmlLayer);

      kmlLayer = omnivore.kml(kmlFile)
        .on('ready', function() {
          this.eachLayer(function(layer) {
            // Aplica estilo a polígonos y multipolígonos
            if(layer.setStyle) {
              layer.setStyle({
                color: '#ff0000',       // borde rojo
                weight: 2,
                fillColor: '#ffaaaa',   // relleno rosa claro
                fillOpacity: 0.5
              });
            }
            var props = layer.feature.properties || {};
            layer.bindPopup('<b>' + (props.name||'Territorio') + '</b><br>' + (props.description||''));
          });
          map.fitBounds(this.getBounds());
        })
        .addTo(map);
    }
  </script>
</body>
</html>
